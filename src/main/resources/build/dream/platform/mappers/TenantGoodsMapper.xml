<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="build.dream.platform.mappers.TenantGoodsMapper">
    <select id="findAllGoodsInfos" resultType="build.dream.common.utils.UnderscoreToCamelCaseMap">
        SELECT
        tenant_goods.tenant_id,
        tenant_goods.branch_id,
        tenant_goods.expire_time,
        tenant_goods.goods_id,
        goods.name
        FROM tenant_goods
        LEFT OUTER JOIN goods ON tenant_goods.goods_id = goods.id
        WHERE tenant_goods.tenant_id = #{tenantId}
        AND tenant_goods.branch_id IN (#{branchId}, 0)
    </select>

    <select id="findGoodsInfo" resultType="build.dream.common.utils.UnderscoreToCamelCaseMap">
        SELECT
        tenant_goods.tenant_id,
        tenant_goods.branch_id,
        tenant_goods.expire_time,
        tenant_goods.goods_id,
        goods.name
        FROM tenant_goods
        INNER JOIN goods ON tenant_goods.goods_id = goods.id
        WHERE tenant_goods.tenant_id = #{tenantId}
        AND tenant_goods.branch_id IN (#{branchId}, 0)
        AND tenant_goods.goods_id = #{goodsId}
    </select>
    
    <select id="findAllExpiredBranches" resultType="build.dream.common.utils.UnderscoreToCamelCaseMap">
        SELECT
        tenant.id AS tenant_id,
        tenant.code AS tenant_code,
        tenant.business,
        tenant.partition_code,
        tenant_goods.branch_id,
        tenant_goods.goods_id,
        goods.goods_type_id,
        goods_type.renew_sql,
        goods_type.disable_sql
        FROM tenant_goods
        LEFT OUTER JOIN tenant ON tenant.id = tenant_goods.tenant_id
        LEFT OUTER JOIN goods ON goods.id = tenant_goods.goods_id
        LEFT OUTER JOIN goods_type ON goods_type.id = goods.goods_type_id
        WHERE tenant_goods.deleted = 0
        AND tenant_goods.expire_time = #{expireTime}
    </select>
</mapper>